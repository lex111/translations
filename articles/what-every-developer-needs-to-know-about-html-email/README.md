# Что каждый разработчик должен знать о электронной почте в HTML

*Перевод статьи [Jason Rodriguez](https://twitter.com/RodriguezCommaJ): [What every developer needs to know about HTML email](https://blog.logrocket.com/what-every-developer-needs-to-know-about-html-email-df70b7c01b39).*

![](https://cdn-images-1.medium.com/max/2000/1*_aQDJV7CZJ6gEW9KLd9VLQ.jpeg)

Электронные HTML-письма: вы можете любить их, вы можете ненавидеть их, но в любом случае вы слышали о них. Готов поспорить, что у вас есть своя точка зрения о них. Но знаете ли вы, что HTML-письмо является исторически одним из самых ценных и важных каналов связи для компаний?

Когда речь идёт о маркетинге и рассылке писем (например, всё то, что попадёт во вкладку "Акции" в Gmail), компании могут рассчитывать в среднем на 35-44 доллара на каждый потраченный доллар, в зависимости от того, [кого вы спросите](https://www.campaignmonitor.com/blog/email-marketing/2016/01/70-email-marketing-stats-you-need-to-know/). Окупаемость инвестиций (return on investment, ROI) электронной почты ежедневно превосходит партнёрский маркетинг, оплаченный поиск, медийную рекламу и социальные сети, делая их важнейшим инструментом каждой компании.

Транзакционные письма - тип электронных писем, отправляемых на основе некоторого действия пользователя (например, покупка, обновление аккаунта, уведомление о доставке и т.д.), ещё более эффективны. [Одно исследование](http://www.experian.com/assets/marketing-services/reports/transactional-email-report.pdf), проведённое Experian, оценивает полезность транзакционных писем в 8 раз выше по сравнению с маркетинговыми письмами и рассылками. 

Хотя многие разработчики могут не столкнуться по работе с маркетинговыми письмами или рассылками, большинство их них рано или поздно коснутся транзакционных писем. На самом деле разработчики часто является единственными, у кого есть непосредственный контроль над транзакционными письмами, так как многие из них генерируются с помощью приложения или напрямую привязаны к кодовой базе. 

Поскольку транзакционные письма доказали, что они создают значительную ROI для компаний, а [лучшие разработчики - это те, кто понимает бизнес](https://blog.logrocket.com/want-to-increase-your-worth-as-a-developer-learn-to-impact-the-business-f7f78ec23ff5), крайне важно, чтобы разработчики понимали основы работы с электронной почтой HTML.

Вот что вам нужно знать.

## Типы писем

Существуют два основных типа писем: маркетинговые (или рассылки) и транзакционные.

__Маркетинговые письма__ - это то, о чём вы вспоминаете, когда думаете об электронных письмах HTML. Они отправляются списку людей, которые подписались для их получения. Это могут быть купоны, информационные рассылки, приглашения к мероприятиям или множество других вещей, но всё это рассылки. Несмотря на то, что они могут (и должны) быть персонализированными, всё равно большая группа людей, получают электронную почту от одного события отправки.


__Транзакционные письма__ напротив является индивидуальными сообщениями и отправляются в ответ на какое-либо полученное событие. К ним относятся письма об оплате, отправка уведомлений и такие служебные письма, например, о сбросе пароля или уведомление об изменении данных учётной записи.  

Иногда между ними остаётся много неясного, но важно попытаться поместить электронное письмо в одну их этих двух категорий, особенно когда вы начинаете рассматривать права доступа подписчика. [С 25 мая, когда начала действовать GDPR](https://litmus.com/blog/5-things-you-must-know-about-email-consent-under-gdpr), любой, кто отправляет электронные письма, должен получить явное разрешение от подписчиков и вести запись об этом разрешении, в противном случае столкнётся с большими штрафами.  

## Аутентификация

Когда пришло время отправлять HTML-письма - будь то маркетинговые или транзакционные - первым шагом должен быть настройка окружения, с которого будет отправляться почта. Несмотря на то, что предпочтут стороннего поставщика электронной почты (email service provider, ESP), такого как Campaign Monitor, MailChimp или Salesforce Marketing Cloud (или Postmark и Sendgrid для транзакционных писем), по-прежнему необходимо понять основную инфраструктуру и процесс аутентификации при отправке писем. ESP многое сделает за вас, но всё равно нужно будет настроить правильные записи аутентификации для обеспечения доставки ваших писем подписчикам.

Электронная почта через __Simple Message Transfer Protocol (SMTP)__. Он полагается на ряд проверок, сделанных интернет-провайдером (ISP), чтобы убедиться, что вы действительно тот, кто отправляет электронное письмо. К этому относится IP-адрес или обратные запросы DNS. Хотя это хорошая отправная точка, есть три других метода аутентификации, которые должны правильно настроить для осуществления хорошей возможности доставки писем. 

__Sender Policy Framework (SPF)__ - это запись, хранящаяся в вашем домене, обеспечивающая дополнительную проверку аутентификации. В основном вы добавляете записи SPF и TXT в свои настройки DNS домена, из которого вы отправляете электронные письма, которые включает IP-адрес вашего почтового сервера. Интернет-провайдеры могут проверить ваш IP-адрес как законный, что повышает вероятность, что ваше письмо будет доставлено. Запись SPF выглядит примерно так:

![](https://cdn-images-1.medium.com/max/1000/0*CgPuTtNUkTGS87uy)

Проект Sender Policy Framework содержит дополнительную информацию о записях SPF и его синтаксисе на [соответствующем сайте](http://www.openspf.org/Project_Overview).


__DomainKeys Identified Mail (DKIM)__ - ещё один механизм аутентификации вашего сообщения. С DKIM вы, по сути, настраиваете ключи, на которые возлагается ответственность за электронную почту. DKIM подписывает электронное письмо закрытым ключом, которое после декодируется с помощью открытого ключа. Открытый ключ - это ещё одна запись DNS для вашего домена с которого отправляются письма, которая выглядит следующим образом (взято с [сайта DKIM](http://dkim.org/info/dkim-faq.html)):

![](https://cdn-images-1.medium.com/max/1600/0*-JMte4Beayuv-wmD)

Наконец, существует __Domain-based Message Authentication, Reporting and Conformance (DMARC)__. Хотя DMARC технически не является механизмом аутентификации, он информирует получателя, что сообщение защищено другими механизмами, такими как SPF и DKIM. Если какой-либо из этих механизмов выходит из строя, DMARC сообщает получателю, что делать с сообщением: Pass, quarantine или fail. Затем он предоставляет механизм для уведомления отправителя о том, что произошло с сообщением. Это мощный способ отслеживать вашу репутацию отправки и смотреть, кто (если кто-либо) злоупотребляет вашей почтовой инфраструктурой.  

Как и два упомянутых механизма, DMARC представляется как DNS-запись, но в этот раз в поддомене, например, _dmarc.example.com. Вы можете установить пороговые значения в DMARC с помошью тега `pct`, а затем сообщить получателю, что делать с этими электронными сообщениями с использованием тега `p` или тега , который принимает следующие значения: `none`, `quarantine` и `reject`.

![](https://cdn-images-1.medium.com/max/1000/0*ocpyMqXK3i7TMKse)

Важно отметить, что DMARC работает совместно с другими протоколами аутентификации. При правильной настройке все они являются частью цепочки доставки, которая помогает предотвратить спам.

![](https://cdn-images-1.medium.com/max/800/1*UKOs_XKjBIhpQtPVlwnPgg.png)
Краткий обзор цепочки доставки электронной почты

Хотя существует другие методы аутентификации, такие как SenderID и DomainKeys, они реализованы меньшим количеством интернет-провайдеров. Я оставлю это вам для дальнейшего исследования.

## MIME-типы

После того, как на ваших доменах должны образом настроена аутентификация и можно отправлять письма, пришло время создавать эти письма. Сначала вы можете подумать, что HTML-письма, - это простые HTML-документы. Но на деле это нечто большее.

Сообщения электронной почты представляют собой сочетание как самого сообщения, так и заголовков, которые определяют информацию об этом сообщении. Когда дело доходит до доставки писем, пары ключ-значение в заголовке, такие как name, sender, subject и return-path, указывают почтовым клиентам, кто отправляет сообщение. Многие из них используются вышеупомянутыми механизмами для аутентификации сообщения.

Но есть одна пара ключ-значение, которая непосредственно связана с созданием фактическим сообщением. Это ключ , который принимает типа для уведомления получателя о наличии в сообщении нескольких частей и отобразить соответствующую часть для подписчика в зависимости от его предпочтений. Когда в сообщение включено несколько частей, электронное письмо называется "электронным письмом __Multipurpose Internet Mail Extensions (MIME)__".

Существует два основных типа содержимого, используемые во всех HTML-письмах: `text/plain` и `text/html`. Тип HTML - это место, где фактический HTML вводиться в сообщение, в то время как обычный (`plain`) тип - это место, где находится текстовая версия электронного письма. В целях лучшей доставки писем, вы всегда должны включать текстовую версию электронного письма, которая тесно соответствует или относится к HTML-версии вашего электронного письма.

Кроме этого, есть дополнительные типы контента, которые могут быть использованы, но иметь ограниченную поддержку от ESP. Тип text/watch-html можно использовать для отправки ограниченной версии HTML-письма для пользователей Apple Watch, в результате чего появились сообщения в виде текста.

Не так давно был тип text/x-amp-html был представлен проектом Google AMP, позволяющий создавать более интерактивные электронные письма с более богатыми возможностями 
при использовании разметки AMP.

Следует отметить, что с момента написания, проект ещё находится на ранних этапах, и никакие ESP не поддерживают добавление MIME-типа AMP к исходящей почте, что делает его практически бесполезным вне окружения предварительного просмотра разработчика Google и окружения тестирования.

Создание полного сообщения электронного письма и учёт различных заголовков и частей MIME может быть сложным. К счастью, большинство ESP заботятся об этой тяжелой работы за вас, позволяя загружать вам только HTML и простые текстовые версии сообщения. Тем не менее, важно знать, как создаются эти сообщения, поскольку многие компании по-прежнему создают собственные почтовые сервисы без обеспечения безопасности, как у стороннего ESP.

## Основы HTML и CSS

Несмотря на то, что вы, вероятно, находитесь на передовых позициях веб-разработки, HTML-письмо обычно отстают от веба в плане используемой разметки для писем. Вы можете использовать div и семантическую разметку в сочетании в последними новинками в CSS, например, flexbox и grid, но большинство популярных почтовых клиентов используют только подмножество HTML и CSS. Из-за проблем с безопасностью и агрессивных (и часто устаревших) движков рендеринга, клиенты электронной почты будут удалять, изменять или игнорировать много фрагментов кода HTML и CSS.

Вот почему большинство кампаний электронной почты сегодня используют таблицы для формирования структуры контента и встроенный CSS для стилизации контента. Если вы создаёте одноколоночные электронные письма, вы можете избежать электронные письма на основе div, но для чего-то, требующего несколько колонок, вы застряли с использованием таблиц в том или ином виде.

Давайте рассмотрим основы.

### Структура электронного письма

Структура и содержание ваших писем будут в основном находится внутри HTML-таблиц. Хотя это больно, вам не нужно беспокоиться обо всех тегах, связанных с таблицей: сама таблица (`table`), строка таблицы (`tr`), ячейка таблицы (`td`). Таблица будет контейнером вашего электронного письма, а строка и ячейка - отдельные модули в этом письме.

Например, если у вас простое электронное письмо с логотипом, заголовком, изображением, параграфом и кнопкой, вся эта структура схематично будет выглядит так:

![](https://cdn-images-1.medium.com/max/800/1*emhMm_w0J01AUMiXlwtzLA.png)

Каждый их этих отдельных элементов может быть его собственным модулем в своей собственной строке и ячейке таблицы. Сохранение модульности электронного письма позволяет легко устранять проблемы в электронной почте, а также быстро комбинировать различные типы модулей для создания различных типов макетов электронных писем.

По соображениям доступности вы должны включать атрибут ARIA-атрибут `role=presentation` для каждого элемента таблицы в вашем письме. Это предотвратит экранным дикторам (screen readers) считывать содержимое в виде табличных данных, что упрощает понимание электронных писем. 

Внутри этих модулей вы должны полагаться на знакомую семантическую разметку для вашего контента. Если вы отмечаете заголовок, используйте соответствуюшие элементы для этого, такие как `h1`, `h2` и т.д. Если вы хотите вставить параграф, то используйте тег `p`. Не каждый почтовый клиент поддерживает новые семантические теги, такие как `header` или `article`, но для людей, использующих экранных считывателей, добавление семантики может быть очень полезно.

Изображения намного сложнее, но в целом неплохо. Некоторым старым почтовым клиентам нравятся добавлять пробелы вокруг изображений или неправильно вставляют или ограничивают размеры изображений в зависимости от размера его родительского элемента. Оба случая могут привести к нарушению отображения макета и плохому пользовательскому опыту. Кроме того, [почти половина всех пользователей открывают электронные письма на мобильных устройствах](https://litmus.com/blog/the-2017-email-client-market-share-infographic), поэтому мы хотим, чтобы были адаптивными по умолчанию на всех устройствах. Это потребует немного больше кода, но зато такая разметка будет охватывать все варианты использования в электронных письмах. 

```html
<img alt="descriptive alternative text" src="https://example.com/img/example.jpg" width="600" border="0" style="display: block; max-width: 100%; min-width: 100px; width: 100%;">
```

Для недекоративных изображений всегда должен присутствовать альтернативный текст (тег `alt`). Это особенно актуально в случае электронных писем, так как многие почтовые клиенты блокируют по умолчанию изображения. В подобных случаях отобразится альтернативный текст. Вы даже можете создать стиль для текста в ряде многих клиентов, применив его к тегу изображения, например, цвет и размер шрифта.

Атрибут `width` используется для клиентов, которые не выводят правильного размера изображения, и атрибут `border`, установленный в ноль, чтобы предотвратить синие рамки вокруг изображений в ссылках. Использование `display: block` гарантирует, что вокруг изображения не будут добавляться лишние пробелы. Комбинация `max-width`, `min-width` и `width`  позволяет масштабировать изображения в зависимости от размера устройства, без нарушения макета электронных писем или делая их слишком маленькими на совсем небольших размеров устройствах.

Использование адаптивных изображений по умолчанию и семантической разметки внутри макетах на основе таблиц на 90% закончат вашу работу с электронным письмом. Для оставшихся 10% вам, вероятно, придётся покопаться в более сложных методах, таких как гибридное кодирование (hybrid coding), которые используют резиновые разметки (fluid layouts) и фиксированную ширину (fixed-width), условный код Microsoft для обеспечения надёжной, адаптивной кампании электронных писем. [Посмотрите на мой сайт с закладками](https://thebetter.email/resources) для получения дополнительных ресурсов.

## Стилизация контента

Когда дело доходит до стилизации контента, вы можете оставить всё относительно простым. Для максимальной совместимости вы должны применять встроенные стили к определённым элементам HTML, которые вы пытаетесь стилизировать. Хотя примерно 90% основных почтовых клиентов теперь поддерживают включаемые стили, по-прежнему остаются несколько клиентов, которые не будут отображать подобные стили, что приведёт к плохо отформатированным письмам. Недавно я писал о [дебатах между встроенными и включаемыми стилями](https://litmus.com/blog/do-email-marketers-and-designers-still-need-to-inline-css), если вы хотите подробнее изучить эту тему.

Для текста основные свойства CSS, такие как `color`, `font-family`, `font-size`, `font-style`, `font-weight` и `line-height`, будут работать хорошо, поскольку они широко поддерживаются всеми основными почтовыми клиентами. Для блочных элементов, таких как заголовки и параграфы, вы можете переопределить свойство `margin` для удаления дополнительного проблема. Зачастую более надёжнее добавлять `padding` к отдельным ячейкам таблицы, так как некоторые старые клиенты не поддерживают свойство `margin`.

Вы даже можете использовать веб-шрифты во многих почтовых клиентах аналогичным образом как при вёрстке сайтов. Используйте CSS-правило `@font-face` или ссылку на внешнюю таблицу стилей и подключить их стеке шрифтов. Только не забудьте включить надёжные фолбэки для шрифтов, чтобы клиенты, не поддерживающие веб-шрифты, правильно их отображали. 

Кнопки намного сложнее в письмах. Хотя я обычно рекомендую вам переводить ссылки в блочные элементы и использовать комбинацию свойств `background-color`, `color`, `border`, `border-radius` и `padding` для создания таких кнопок, которые вы делаете обычно в вебе, но некоторые почтовые клиенты не отрисовывают правильным образом все эти свойства.

Существуют несколько различных методов для создания так называемых "пуленепробиваемых кнопок" в мире электронной почты, используя свойства `border` и `padding`, или сочетание из них обоих. Если вам нужно действительно что-то пуленепробиваемое, тогда вы можете воспользоваться отличным генератором пуленепробиваемых кнопок, который сгенерирует вам комбинацию кода из HTML и проприетарной Microsoft-разметки Vector Markup Language (VML), которая будет работать во всех клиентах. Только не используйте изображения для кнопок, если получится. Как я упоминал ранее, многие почтовые клиенты блокируют изображения по умолчанию, поэтому кнопки в виде изображений не будут показываться.

## Современные инструменты для электронной почты

Если не горите желаем собственноручным написанием HTML и CSS для электронных писем, есть несколько инструментов, которые облегчат их создание. Скорее всего, вам удобнее было бы работать с фреймворком, которые абстрагирует сложности и следует определенному соглашения для упрощения разработки. В случае электронной почты, такие фреймворки как [MJML](https://mjml.io/) and [Foundation для электронных писем](https://foundation.zurb.com/emails.html), могут быть идеальными.

Оба предоставляют простую разметку, встроенные компоненты и инструменты сборки, позволяющие быстро разрабатывать электронные письма, хорошо работающих во всех клиентах. [Быстрый поиск по GitHub](https://github.com/search?l=HTML&q=html+email+&type=Repositories) выдаст огромное множество шаблонов, фреймворков и инструментов для создания электронных писем HTML.

![](https://cdn-images-1.medium.com/max/800/1*k1yOzhkuINMr7szgVeZqCg.gif)
Интерактивное письмо от [Litmus](https://litmus.com/).

Хотя разметка и методы, описанные выше, довольно просты, не позволяйте этому вводит вас в заблуждение. Электронные письма необязательно должны быть статичными. HTML-письма допускает некоторые по-настоящему сложные и мощные приложения, как добавление интерактивности, позволяя пользователям испытавать с полнофункциональными взаимодействиями прямо в своём почтовом ящике.

Электронное агентство REBEL стала инициатором большей части подобной работы. Они создали всё, начиная от простых каруселей и заканчивая полным оформлением заказов в кампаниях электронных писем. Они даже открыли API, для того чтобы позволить разработчикам использовать эту интерактивность в собственных рассылках без необходимости создавать всё с нуля.

Если вы хотите собственную интерактивность с нуля, ознакомтесь с тем, что Mark Robbins называет [техникой "кодирования перфокарты"](https://www.webdesignerdepot.com/2015/10/punched-card-coding-the-secret-of-interactive-email/). Используя радиокнопки и чекбоксы, в сочетании с CSS, который стилизирует состояние кнопок и применяет форматирование в зависимости от условия, вы можете создать по-настоящему удивить ваших подписчиков.

## Не отказывайтесь от HTML-писем

HTML-письма могут не быть вашим первым выбором для проекта, но это невероятно мощный инструмент для каждой кампании. Как маркетинговые, так и транзакционные электронные письма делают рентабельность инвестиций, позволяя вам использовать свои навыки разработки для непосредственного воздействия на бизнес. 

Ко всему прочему по мере популярности электронной почты среди покупателей, многие компании рассматривают электронные письма в последнюю очередь. Стандарты электронной почты являются абсурдно низкими, поэтому, если вы отправляете электронные письма, которые даже немного лучше, чем у конкурентов, у вас больше возможности добиться успеха, оказываяя влияние не только на ваш бизнес, но и на жизнь ваших подписчиков. 

- - - -

*Слушайте наш подкаст в [iTunes](https://itunes.apple.com/ru/podcast/девшахта/id1226773343) и [SoundCloud](https://soundcloud.com/devschacht), читайте нас на [Medium](https://medium.com/devschacht), контрибьютьте на [GitHub](https://github.com/devSchacht), общайтесь в [группе Telegram](https://t.me/devSchacht), следите в [Twitter](https://twitter.com/DevSchacht) и [канале Telegram](https://t.me/devSchachtChannel), рекомендуйте в [VK](https://vk.com/devschacht) и [Facebook](https://www.facebook.com/devSchacht).*
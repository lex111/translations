# Тестирование React-приложений с помощью Cypress

*Перевод статьи [Rajat S](https://twitter.com/geeky_writer_): [Testing React Apps with Cypress](https://blog.bitsrc.io/testing-react-apps-with-cypress-658bc482678).*

Краткое руководство по выполнению end-to-end-тестирования приложений на React с помощью Cypress.

![](https://cdn-images-1.medium.com/max/2000/1*FoCFnUGcQvE2zqiFxitXUg.png)

Когда я был младшим разработчиком, меня передёргивало от мысли о тестировании своих приложений. Тестирование не так легко. Но с помощью правильных инструментов, написание тестов, безусловно, могут быть проще и веселее.

Cypress - это Java-Script-фреймворк для end-to-end тестирования, который делает действительно простым настройку, написание, выполнение и отладку тестов.

Если ранее вы использовали фреймворки end-to-end тестирования, такие как Puppetter, то заметите, что они превращают браузер в систему с воздушным потоком. Чем сложнее приложение, тем тяжелее будут проходить тестам. Вот почему большинство тестировщиков предпочитают проводить тесты вручную.

В этой статье я покажу вам, как Cypress может помочь вам создавать тесты, которые будет выполняться в реальном браузере. Cypress предоставляет API для автоматизации тестирования, который очень прост в использовании.

Вместо того, чтобы смотреть на безликое окно терминала, заполненной абракадаброй, Cypress поставляется со своей собственной информационной панелью, на которой показывается, что именно происходит во время выполнения тестов.

Давайте приступим к делу.

## Настройка

Вместо того, чтобы создавать полностью новое приложение, я собираюсь использовать уже существующий проект и запускать тесты Cypress на нём.

Вот, у меня есть простое приложение со списком дел на React.

https://github.com/rajatgeekyants/ToDo-List

![](https://cdn-images-1.medium.com/max/800/1*sFtLSBvrjPNJkb66q1mIxQ.png)

Склонируйте себе это приложение и запустите `yarn install` для установки зависимостей.

```
$ git clone https://github.com/rajatgeekyants/ToDo-List.git
$ yarn install
```

**Примечание**: Вы также можете посмотреть это приложение на Bit. Здесь вы сможете импортировать какой-либо отдельный компонент приложения, на заботясь обо всём остальном.

https://bitsrc.io/geekrajat/todo

Теперь я могу перейти на фазу тестирования приложения. Давайте установим Cypress в виде **зависимости для разработки** в нашем приложении.

```
$ yarn add cypress -D
```

Теперь для открытия Cypress, всё, что нам нужно, так это выполнить следующую команду:

```
$ node_modules/.bin/cypress open
```

Это откроёт Cypress CLI (или информационную панель) на вашей системе, а также создаст файл `cypress.json` и папку `cypress` в корневом каталоге приложения. В каталоге `cypress` мы будем писать тесты.

Если вы считаете команду открытия Cypress слишком длинной или трудной для запоминания, вы можете перейти в файл `package.json` и создать скрипт:

```
"cypress": "cypress open"
```

И так теперь, когда вы запустите этот скрипт при помощи NPM/Yarn, откроется Cypress CLI. В каталоге `cypress` создайте тестовый файл внутри каталога `integration`. В отличие от обычных файлов для тестов, которые обычно называются чем-то вроде `App.test.js`, в Cypress файл теста имеет расширение `.spec.js`.

https://gist.github.com/rajatgeekyants/3ba1e743f9dfa0b16ae22b3050dda1bc

Это очень простой тест, проверяющий только, что `true` равно `true` (что очевидно). Если открыть Cypress CLI, то можно увидеть, что новый тестовый файл будет автоматически перечислен там. При клике на него, вы запустите тест и откроется информационная панель в браузере, где вы сможете увидеть результат теста.

https://cdn-images-1.medium.com/max/800/1*Wh46Wi_P9a90q6nwwzKJ9w.png

Этот тест не имел ничего общего с приложением списка дела. Он просто показал, как запускать тесты с использованием Cypress. Теперь давайте начнём написание тестов для нашего реального приложения.

---

## Посещение страницы в Cypress

Первый шаг в тесте Cypress - позволить ему посетить приложение в браузере. Давайте создадим новый файл теста и напишем в нём следующий код:

https://gist.github.com/rajatgeekyants/8a9c543cd9510385a04aaafec615bb35

В приведённом выше коде у меня есть объект с именем _cy_. Это глобальный объект и даёт нам доступ ко всем командам в API Cypress. Я использую _cy_ для доступа к команде _visit_. Внутри этой команды я просто собираюсь перейти на `/`. Вернитесь к корневому каталогу, перейдите в файл `cypress.json` и напишите в нём следующее:

```
{
  "baseUrl": "http://localhost:3000"
}
```

Теперь убедитесь, что вы запустили приложение, используя npm-скрипт `start`. Затем откройте Cypress CLI и запустите этот новый файл с тестом. Вы увидите открытую информационную панель в браузере, а внутри панели приложение будет работать следующим образом:

![](https://cdn-images-1.medium.com/max/800/1*kpUn1HNHVpKEXAUNPOg3CA.png)

---
 
## Проверка фокуса

Теперь я собираюсь запустить тест, который проверяет, есть ли фокус на поле ввода при загрузке страницы в браузере.

Прежде чем мы начнём, убедитесь, что у поля `input` в `src/components/TodoList/index.js` есть свойство `className` со значением `new task` вместе со свойством `autoFocus`.  

```
<input
  autoFocus
  className="new task"
  ref={a => (this._inputElement = a)}
  placeholder="enter task"
/>
```

Без этих свойств наш тест определённо потерпит неудачу. Создайте новый файл теста со следующим кодом:

https://gist.github.com/rajatgeekyants/3421045131d32589a9b17003f5c749c7

Во-первых, я посещаю (команда `visit`) главную страницу (`/`) в панели Cypress. Когда приложение откроется внутри панели, я проверяю, есть ли фокус на элементе (команда `focused`) с CSS-классом `new task`.

![](https://cdn-images-1.medium.com/max/800/1*egylykedXJ2NpY0K0_t4Ag.png)

---

## Тестирование поля ввода

В новом тесте я собираюсь проверить, принимает ли поле ввода текст и имеет соответствующее значение:

https://gist.github.com/rajatgeekyants/e09e2d1d78346fb1cdd760c490e0d565

В этом тесте я сначала посетил (команда `visit`) приложение внутри панели Cypress. Теперь я хочу, чтобы Cypress ввёл что-либо внутри поля ввода. Чтобы найти правильный селектор для поля ввода, нажмите на кнопку `Open Selector Playground` и щёлкните на поле ввода.

![](https://cdn-images-1.medium.com/max/800/1*MfeHIpz2_SYwcUY0raMdaQ.gif)

Получив селектор для поля ввода, я указываю Cypress выполнить команду `type`, вводя в поле некоторый текст. Для того, чтобы убедиться, что Cypress набрал корректный текст, я использую команду `should`.

---

## Выполнение тестов без использования пользовательского интерфейса

Из-за пользовательский интерфейса (UI) приложение может работать медленнее в случае большого количества тестов. Пользовательский интерфейс в любом случае не будет виден при непрерывной интеграции, поэтому зачем использовать его тогда?

Для запуска тестов без запуска Cypress UI, сначала нам нужно добавить новый скрипт в файл `package.json`:

```
"cypress:all": "cypress run"
```

Запустив этот скрипт, Cypress запустит все тесты и предоставит результаты напрямую в самом терминале.

![](https://cdn-images-1.medium.com/max/800/1*5ohUyAlbFGgkmO7_K2hI0w.png)

---

## Создание end-to-end теста в Cypress

Cypress больше всего полезен, при использовании его для написания интеграционных тестов. Но тест end-to-end гарантирует, что во всём приложении ничего не было пропущено.

https://gist.github.com/rajatgeekyants/21e1a79af09a46d43b232dd1eec36754

Здесь я создал end-to-end тест. Сначала с помощью Cypress я посещаю (`visit`) страницу, после получаю поле вводе с селектором `.new`, затем Cypress вводит тест `New Todo`. Наконец, через Cypress я имитирую действие отправки ввода (`enter`), которое следовательно создаст новой элемент списка дел.

![](https://cdn-images-1.medium.com/max/800/1*wcIDOda8sVB_ROYIlCEdww.gif)

## Что дальше?

Существует много других вещей, которые можно сделать с Cypress. Например, можно протестировать варианты функций, или мы можем получить доступ к пошаговым логам тестов. Кроме того, есть много других вещей, которые Cypress может сделать с React-приложениями с серверным рендерингом, которые я попытаюсь охватить в своей следующей статье.

- - - -

*Слушайте наш подкаст в [iTunes](https://itunes.apple.com/ru/podcast/девшахта/id1226773343) и [SoundCloud](https://soundcloud.com/devschacht), читайте нас на [Medium](https://medium.com/devschacht), контрибьютьте на [GitHub](https://github.com/devSchacht), общайтесь в [группе Telegram](https://t.me/devSchacht), следите в [Twitter](https://twitter.com/DevSchacht) и [канале Telegram](https://t.me/devSchachtChannel), рекомендуйте в [VK](https://vk.com/devschacht) и [Facebook](https://www.facebook.com/devSchacht).*